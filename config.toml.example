# anthropic-lb configuration
listen = "127.0.0.1:8082"
upstream = "https://api.anthropic.com"
strategy = "dynamic-capacity"
rate_limit_cooldown_secs = 60
probe_interval_secs = 300

# Proxy authentication: clients must send this as x-api-key to access the proxy.
# Omit to leave proxy open (use only behind Tailscale/VPN).
# proxy_key = "your-secret-key-here"

# IP allowlist: only accept connections from these IPs/CIDRs.
# Supports individual IPs and CIDR ranges. Omit or leave empty to allow all.
# allowed_ips = ["100.64.0.0/10", "10.0.0.0/8", "1.2.3.4"]

# Operators: these client_ids are never throttled by utilization limits, budget limits,
# or the emergency brake. Identity resolved via x-client-id header or client_names IP map.
# operators = ["ray", "openclaw", "claude"]

# Per-client utilization limits: clients are 429'd when ALL model-compatible accounts
# exceed their configured limit. Values must be 0.0-1.0.
# [client_utilization_limits]
# gastown = 0.85
# openclaw = 0.95

# Emergency brake: when ALL accounts exceed this threshold, all non-operator traffic
# is automatically blocked. Default: 0.88.
# emergency_threshold = 0.88

# Redis/Valkey URL for distributed state (multi-replica coordination).
# When set, budget enforcement and hard-limit propagation use Redis for cross-replica sync.
# Omit for single-instance deployments (local-only state).
# redis_url = "redis://10.0.0.5:6379"

# "passthrough" = forward caller's auth headers as-is (for OpenClaw managed tokens)
# Any other value = inject as the account's own token
# OAuth tokens (sk-ant-oat*) are injected as Authorization: Bearer
# Standard keys (sk-ant-api*) are injected as X-Api-Key
[[accounts]]
name = "primary"
token = "sk-ant-oat01-YOUR_TOKEN_HERE"

[[accounts]]
name = "secondary"
token = "sk-ant-oat01-YOUR_TOKEN_HERE"
